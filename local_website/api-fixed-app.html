<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wedding Genie - API Fixed</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #ffeef3 0%, #f8e8ee 50%, #f5d0e0 100%);
            min-height: 100vh;
            color: #2d2d2d;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            min-height: 100vh;
            background: white;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #8B4B6B, #A855A8);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .ai-status {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 8px;
            height: 8px;
            background: #4CAF50;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .title { font-size: 20px; font-weight: 600; }
        .subtitle { font-size: 12px; opacity: 0.9; margin-top: 4px; }

        .content { flex: 1; padding: 24px; overflow-y: auto; }

        .form-section { margin-bottom: 24px; }
        .section-title { font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #2d2d2d; }

        .form-group { margin-bottom: 16px; }
        .form-label { display: block; font-size: 14px; font-weight: 500; margin-bottom: 8px; }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #8B4B6B;
            box-shadow: 0 0 0 3px rgba(139, 75, 107, 0.1);
        }

        .city-autocomplete { position: relative; }

        .city-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }

        .city-suggestion {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .city-suggestion:hover { background: rgba(139, 75, 107, 0.05); }

        .checkbox-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 8px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border: 1px solid #eee;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            background: rgba(139, 75, 107, 0.05);
            border-color: #8B4B6B;
        }

        .btn-primary {
            background: linear-gradient(135deg, #8B4B6B, #A855A8);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: transform 0.3s ease;
        }

        .btn-primary:hover { transform: translateY(-2px); }
        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

        .ai-results {
            background: rgba(139, 75, 107, 0.05);
            border-radius: 16px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid rgba(139, 75, 107, 0.1);
        }

        .result-item {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .result-title { font-size: 14px; font-weight: 600; color: #2d2d2d; margin-bottom: 8px; }
        .result-desc { font-size: 13px; color: #666; line-height: 1.4; }

        .loading { text-align: center; padding: 40px 20px; color: #8B4B6B; }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(139, 75, 107, 0.1);
            border-left: 4px solid #8B4B6B;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        .error-message {
            background: #ffebee;
            border: 1px solid #ffcdd2;
            color: #c62828;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .success-message {
            background: #e8f5e8;
            border: 1px solid #c8e6c9;
            color: #2e7d32;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="ai-status" title="AI Agents Status"></div>
            <div class="title">Wedding Genie</div>
            <div class="subtitle">AI-Powered Wedding Planning</div>
        </div>

        <div class="content">
            <div id="error-container"></div>
            
            <div class="form-section">
                <div class="section-title">Couple Information</div>
                
                <div class="form-group">
                    <label class="form-label">Your Name *</label>
                    <input type="text" class="form-input" id="yourName" placeholder="Enter your name" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Partner's Name *</label>
                    <input type="text" class="form-input" id="partnerName" placeholder="Enter partner's name" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Wedding Date *</label>
                    <input type="date" class="form-input" id="weddingDate" required>
                </div>
            </div>

            <div class="form-section">
                <div class="section-title">Wedding Preferences</div>
                
                <div class="form-group">
                    <label class="form-label">City *</label>
                    <div class="city-autocomplete">
                        <input type="text" class="form-input" id="city" placeholder="Type city name..." required>
                        <div class="city-suggestions" id="city-suggestions"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Budget Range *</label>
                    <select class="form-input" id="budget" required>
                        <option value="">Select budget</option>
                        <option value="₹5-10 Lakhs">₹5-10 Lakhs</option>
                        <option value="₹10-20 Lakhs">₹10-20 Lakhs</option>
                        <option value="₹20-30 Lakhs">₹20-30 Lakhs</option>
                        <option value="₹30-50 Lakhs">₹30-50 Lakhs</option>
                        <option value="₹50+ Lakhs">₹50+ Lakhs</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Guest Count</label>
                    <input type="number" class="form-input" id="guestCount" placeholder="200" min="50" max="2000">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Wedding Type</label>
                    <select class="form-input" id="weddingType">
                        <option value="Traditional Hindu">Traditional Hindu</option>
                        <option value="Sikh">Sikh</option>
                        <option value="Muslim">Muslim</option>
                        <option value="Christian">Christian</option>
                        <option value="Inter-faith">Inter-faith</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Wedding Duration</label>
                    <select class="form-input" id="duration">
                        <option value="1 day">1 day</option>
                        <option value="2 days">2 days</option>
                        <option value="3 days" selected>3 days</option>
                        <option value="4 days">4 days</option>
                        <option value="5+ days">5+ days</option>
                    </select>
                </div>
            </div>

            <div class="form-section">
                <div class="section-title">Priority Areas</div>
                <p style="color: #666; font-size: 14px; margin-bottom: 16px;">Select your top priorities</p>
                
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="priority-venue" value="Venue" checked>
                        <label for="priority-venue">Venue</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="priority-photography" value="Photography" checked>
                        <label for="priority-photography">Photography</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="priority-catering" value="Catering">
                        <label for="priority-catering">Catering</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="priority-decoration" value="Decoration">
                        <label for="priority-decoration">Decoration</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="priority-music" value="Entertainment">
                        <label for="priority-music">Music</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="priority-transport" value="Transport">
                        <label for="priority-transport">Transport</label>
                    </div>
                </div>
            </div>

            <button class="btn-primary" onclick="submitWeddingForm()">
                Get AI Wedding Plan
            </button>

            <div class="loading" id="form-loading" style="display: none;">
                <div class="spinner"></div>
                <p>AI analyzing your preferences...</p>
            </div>

            <div id="wedding-results" class="ai-results" style="display: none;">
                <h3 style="color: #8B4B6B; margin-bottom: 16px;">🧞‍♂️ AI Analysis</h3>
                <div id="wedding-recommendations"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8001';

        // Indian cities for autocomplete
        const indianCities = [
            { name: "Mumbai", state: "Maharashtra" },
            { name: "Delhi", state: "Delhi" },
            { name: "Bangalore", state: "Karnataka" },
            { name: "Chennai", state: "Tamil Nadu" },
            { name: "Kolkata", state: "West Bengal" },
            { name: "Pune", state: "Maharashtra" },
            { name: "Hyderabad", state: "Telangana" },
            { name: "Ahmedabad", state: "Gujarat" },
            { name: "Jaipur", state: "Rajasthan" },
            { name: "Surat", state: "Gujarat" },
            { name: "Lucknow", state: "Uttar Pradesh" },
            { name: "Kanpur", state: "Uttar Pradesh" },
            { name: "Nagpur", state: "Maharashtra" },
            { name: "Indore", state: "Madhya Pradesh" },
            { name: "Bhopal", state: "Madhya Pradesh" },
            { name: "Visakhapatnam", state: "Andhra Pradesh" },
            { name: "Patna", state: "Bihar" },
            { name: "Vadodara", state: "Gujarat" },
            { name: "Ludhiana", state: "Punjab" },
            { name: "Agra", state: "Uttar Pradesh" },
            { name: "Nashik", state: "Maharashtra" },
            { name: "Faridabad", state: "Haryana" },
            { name: "Meerut", state: "Uttar Pradesh" },
            { name: "Rajkot", state: "Gujarat" },
            { name: "Varanasi", state: "Uttar Pradesh" },
            { name: "Srinagar", state: "Jammu and Kashmir" },
            { name: "Aurangabad", state: "Maharashtra" },
            { name: "Amritsar", state: "Punjab" },
            { name: "Allahabad", state: "Uttar Pradesh" },
            { name: "Ranchi", state: "Jharkhand" },
            { name: "Coimbatore", state: "Tamil Nadu" },
            { name: "Jodhpur", state: "Rajasthan" },
            { name: "Madurai", state: "Tamil Nadu" },
            { name: "Raipur", state: "Chhattisgarh" },
            { name: "Kota", state: "Rajasthan" },
            { name: "Guwahati", state: "Assam" },
            { name: "Chandigarh", state: "Chandigarh" },
            { name: "Mysore", state: "Karnataka" },
            { name: "Gurgaon", state: "Haryana" },
            { name: "Aligarh", state: "Uttar Pradesh" },
            { name: "Jalandhar", state: "Punjab" },
            { name: "Bhubaneswar", state: "Odisha" },
            { name: "Salem", state: "Tamil Nadu" },
            { name: "Thiruvananthapuram", state: "Kerala" },
            { name: "Noida", state: "Uttar Pradesh" },
            { name: "Jamshedpur", state: "Jharkhand" },
            { name: "Kochi", state: "Kerala" },
            { name: "Dehradun", state: "Uttarakhand" },
            { name: "Ajmer", state: "Rajasthan" },
            { name: "Jamnagar", state: "Gujarat" },
            { name: "Ujjain", state: "Madhya Pradesh" },
            { name: "Siliguri", state: "West Bengal" },
            { name: "Jhansi", state: "Uttar Pradesh" },
            { name: "Jammu", state: "Jammu and Kashmir" },
            { name: "Mangalore", state: "Karnataka" },
            { name: "Udaipur", state: "Rajasthan" }
        ];

        // City Autocomplete
        function setupCityAutocomplete() {
            const cityInput = document.getElementById('city');
            const suggestions = document.getElementById('city-suggestions');

            cityInput.addEventListener('input', function() {
                const query = this.value.toLowerCase().trim();
                
                if (query.length < 2) {
                    suggestions.style.display = 'none';
                    return;
                }

                const matches = indianCities.filter(city => 
                    city.name.toLowerCase().includes(query) ||
                    city.state.toLowerCase().includes(query)
                ).slice(0, 8);

                if (matches.length > 0) {
                    suggestions.innerHTML = matches.map(city => `
                        <div class="city-suggestion" onclick="selectCity('${city.name}')">
                            <span style="color: #8B4B6B;">📍</span>
                            <div>
                                <div style="font-weight: 600;">${city.name}</div>
                                <div style="font-size: 12px; color: #666;">${city.state}</div>
                            </div>
                        </div>
                    `).join('');
                    suggestions.style.display = 'block';
                } else {
                    suggestions.style.display = 'none';
                }
            });

            document.addEventListener('click', function(e) {
                if (!cityInput.contains(e.target) && !suggestions.contains(e.target)) {
                    suggestions.style.display = 'none';
                }
            });
        }

        function selectCity(cityName) {
            document.getElementById('city').value = cityName;
            document.getElementById('city-suggestions').style.display = 'none';
        }

        function validateForm() {
            const required = ['yourName', 'partnerName', 'weddingDate', 'city', 'budget'];
            const errors = [];

            required.forEach(field => {
                const element = document.getElementById(field);
                if (!element.value.trim()) {
                    errors.push(`${field.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())} is required`);
                }
            });

            const weddingDate = new Date(document.getElementById('weddingDate').value);
            const today = new Date();
            if (weddingDate <= today) {
                errors.push('Wedding date must be in the future');
            }

            return errors;
        }

        function showError(errors) {
            const container = document.getElementById('error-container');
            if (errors.length > 0) {
                container.innerHTML = `
                    <div class="error-message">
                        <strong>Please fix:</strong><br>
                        ${errors.map(error => `• ${error}`).join('<br>')}
                    </div>
                `;
            } else {
                container.innerHTML = '';
            }
        }

        function showSuccess(message) {
            const container = document.getElementById('error-container');
            container.innerHTML = `<div class="success-message">${message}</div>`;
        }

        function getSelectedPriorities() {
            const priorities = [];
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                priorities.push(checkbox.value);
            });
            return priorities.length > 0 ? priorities : ['Photography', 'Venue'];
        }

        async function submitWeddingForm() {
            const errors = validateForm();
            if (errors.length > 0) {
                showError(errors);
                return;
            }

            showError([]);

            const formData = {
                yourName: document.getElementById('yourName').value.trim(),
                partnerName: document.getElementById('partnerName').value.trim(),
                weddingDate: document.getElementById('weddingDate').value,
                city: document.getElementById('city').value.trim(),
                budget: document.getElementById('budget').value,
                guestCount: parseInt(document.getElementById('guestCount').value) || 200,
                weddingType: document.getElementById('weddingType').value || "Traditional Hindu",
                duration: document.getElementById('duration').value || "3 days",
                events: ["Wedding", "Reception"],
                priorities: getSelectedPriorities(),
                specialRequirements: ""
            };

            console.log('Submitting:', formData);

            const button = event.target;
            button.disabled = true;
            button.textContent = 'Processing...';
            
            document.getElementById('form-loading').style.display = 'block';
            document.getElementById('wedding-results').style.display = 'none';

            try {
                const response = await fetch(`${API_BASE}/submit-wedding`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const responseText = await response.text();
                console.log('Response:', responseText);

                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (parseError) {
                    throw new Error('Invalid response from AI service');
                }

                displayResults(result, response.ok);

            } catch (error) {
                console.error('Error:', error);
                displayResults({
                    success: false,
                    error: 'Connection failed. AI service may be offline.'
                }, false);
            } finally {
                button.disabled = false;
                button.textContent = 'Get AI Wedding Plan';
                document.getElementById('form-loading').style.display = 'none';
            }
        }

        function displayResults(result, responseOk) {
            const resultsDiv = document.getElementById('wedding-results');
            const recommendationsDiv = document.getElementById('wedding-recommendations');
            
            resultsDiv.style.display = 'block';
            
            if (responseOk && result.success !== false) {
                showSuccess('✅ Wedding plan created successfully!');
                
                recommendationsDiv.innerHTML = `
                    <div class="result-item">
                        <div class="result-title">✅ Plan Created</div>
                        <div class="result-desc">AI has analyzed your preferences and created a personalized plan.</div>
                    </div>
                    <div class="result-item">
                        <div class="result-title">💰 Budget Analysis</div>
                        <div class="result-desc">Smart budget allocation available. Visit Budget section for details.</div>
                    </div>
                    <div class="result-item">
                        <div class="result-title">🔍 Vendor Matching</div>
                        <div class="result-desc">AI vendor search initiated. Visit Vendor Discovery for matches.</div>
                    </div>
                    <div class="result-item">
                        <div class="result-title">📋 Next Steps</div>
                        <div class="result-desc">
                            1. Check Budget for AI allocation<br>
                            2. Visit Vendor Discovery for matches<br>
                            3. Generate timeline for planning
                        </div>
                    </div>
                `;
            } else {
                const errorMsg = result.error || result.detail || 'Unknown error';
                showError([`AI Service: ${errorMsg}`]);
                
                recommendationsDiv.innerHTML = `
                    <div class="result-item">
                        <div class="result-title">⚠️ Service Issue</div>
                        <div class="result-desc">
                            ${errorMsg}<br><br>
                            Please check if AI service is running on port 8001.
                        </div>
                    </div>
                `;
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupCityAutocomplete();
            
            // Check AI service
            fetch(`${API_BASE}/health`)
                .then(response => response.json())
                .then(data => {
                    const statusDot = document.querySelector('.ai-status');
                    statusDot.style.background = data.status === 'healthy' ? '#4CAF50' : '#FF9800';
                    statusDot.title = `AI Service: ${data.status}`;
                })
                .catch(() => {
                    document.querySelector('.ai-status').style.background = '#F44336';
                });
        });
    </script>
</body>
</html> 